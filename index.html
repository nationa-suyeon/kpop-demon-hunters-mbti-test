<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>케이팝 데몬 헌터스 캐릭터 유형 테스트</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5; /* Light gray background */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
            box-sizing: border-box;
        }
        .container {
            background-color: #ffffff;
            border-radius: 1.5rem; /* More rounded corners */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1); /* Softer shadow */
            max-width: 600px;
            width: 100%;
            padding: 2rem;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .btn {
            background-image: linear-gradient(to right, #6EE7B7, #34D399); /* Green gradient */
            color: white;
            padding: 0.8rem 2rem;
            border-radius: 9999px; /* Pill shape */
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(52, 211, 153, 0.4);
            border: none;
            cursor: pointer;
            font-size: 1.125rem; /* Larger font */
        }
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(52, 211, 153, 0.6);
        }
        .option-btn {
            background-color: #E0F2F7; /* Light blue */
            color: #2C3E50; /* Dark text */
            padding: 1rem 1.5rem;
            margin: 0.5rem 0;
            border-radius: 0.75rem;
            font-weight: 500;
            transition: all 0.2s ease;
            width: 100%;
            text-align: left;
            border: 2px solid transparent;
            cursor: pointer;
        }
        .option-btn:hover {
            background-color: #B3E0F2; /* Slightly darker blue on hover */
            border-color: #007BFF; /* Blue border on hover */
        }
        .option-btn.selected {
            background-color: #3B82F6; /* Blue */
            color: white;
            border-color: #1D4ED8;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.4);
        }
        .progress-bar-container {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 9999px;
            height: 0.75rem;
            margin-bottom: 1.5rem;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background-image: linear-gradient(to right, #3B82F6, #60A5FA); /* Blue gradient */
            width: 0%;
            border-radius: 9999px;
            transition: width 0.3s ease-in-out;
        }
        .character-card {
            background-color: #F8F9FA; /* Off-white */
            border-radius: 1rem;
            padding: 1.5rem;
            margin-top: 1.5rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
            text-align: left;
            width: 100%;
        }
        .character-card h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2C3E50;
            margin-bottom: 0.5rem;
        }
        .character-card p {
            font-size: 1rem;
            color: #555;
            line-height: 1.5;
        }
        .character-video-container {
            width: 150px; /* Adjust size as needed */
            height: 150px;
            background-color: #ddd; /* Placeholder background */
            border-radius: 50%;
            margin: 1rem auto;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 3rem;
            color: #888;
            overflow: hidden; /* Ensure content stays within circle */
            position: relative; /* For absolute positioning of inner elements */
        }
        .character-video-container video {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Ensures video fills the circular container */
            border-radius: 50%; /* Make video circular */
            display: block;
        }
        /* Simple animation for result display */
        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        .result-section {
            animation: fadeInScale 0.5s ease-out forwards;
        }
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .container {
                padding: 1.5rem;
            }
            .btn {
                padding: 0.6rem 1.5rem;
                font-size: 1rem;
            }
            .option-btn {
                padding: 0.8rem 1rem;
                font-size: 0.9rem;
            }
            .character-card h3 {
                font-size: 1.25rem;
            }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen bg-gray-100">
    <div class="container">
        <!-- 랜딩 페이지 -->
        <div id="landing-page" class="flex flex-col items-center justify-center">
            <h1 class="text-4xl font-extrabold text-gray-800 mb-6 leading-tight">
                <span class="block">〈케이팝 데몬 헌터스〉</span>
                <span class="block mt-2">내가 누구?</span>
            </h1>
            <p class="text-lg text-gray-600 mb-8">헌트릭스 시나리오 속 당신의 선택은?</p>
            <button id="start-test-btn" class="btn">3분 테스트 시작</button>
        </div>

        <!-- 질문 페이지 -->
        <div id="question-page" class="hidden w-full">
            <div class="progress-bar-container">
                <div id="progress-bar" class="progress-bar"></div>
            </div>
            <p id="question-number" class="text-lg text-gray-700 mb-4 font-semibold"></p>
            <h2 id="question-text" class="text-2xl font-bold text-gray-800 mb-8 leading-relaxed"></h2>
            <div class="options-container flex flex-col gap-4">
                <button id="option-a" class="option-btn" data-value="1"></button>
                <button id="option-b" class="option-btn" data-value="0"></button>
            </div>
        </div>

        <!-- 결과 페이지 -->
        <div id="result-page" class="hidden w-full result-section">
            <h2 class="text-3xl font-bold text-gray-800 mb-4">당신의 캐릭터는...</h2>
            <div class="character-video-container">
                <!-- 실제 캐릭터 동영상으로 교체될 곳 -->
                <video id="character-video" autoplay loop muted playsinline class="hidden">
                    <source src="" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
                <!-- 비디오가 로드되지 않을 때 표시될 임시 아이콘 -->
                <span id="character-icon" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2">✨</span>
            </div>
            <h3 id="result-character-name" class="text-4xl font-extrabold text-blue-600 mt-4 mb-2"></h3>
            <p id="result-mbti" class="text-xl font-semibold text-gray-700 mb-2"></p>
            <p id="result-description" class="text-md text-gray-600 mb-8 leading-relaxed"></p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 w-full">
                <div class="character-card">
                    <h3 class="text-blue-500">잘 맞는 친구</h3>
                    <p id="compatible-friend-name" class="text-xl font-semibold text-gray-800"></p>
                    <p id="compatible-friend-mbti" class="text-md text-gray-600"></p>
                    <p id="compatible-friend-description" class="text-sm text-gray-500 mt-1 leading-snug"></p>
                </div>
                <div class="character-card">
                    <h3 class="text-red-500">앙숙 친구</h3>
                    <p id="opposite-friend-name" class="text-xl font-semibold text-gray-800"></p>
                    <p id="opposite-friend-mbti" class="text-md text-gray-600"></p>
                    <p id="opposite-friend-keywords" class="text-sm text-gray-500 mt-1"></p>
                </div>
            </div>

            <div class="mt-8 flex flex-col gap-4 w-full">
                <button id="share-result-btn" class="btn bg-blue-500 hover:bg-blue-600">결과 공유하고 친구 초대</button>
                <button id="hey-d-link-btn" class="btn bg-purple-500 hover:bg-purple-600">Hey.D에서 캐릭터와 대화해보기</button>
                <button id="restart-test-btn" class="btn bg-gray-400 hover:bg-gray-500">테스트 다시 하기</button>
            </div>
        </div>
    </div>

    <script>
        // DOM 요소 가져오기
        const landingPage = document.getElementById('landing-page');
        const questionPage = document.getElementById('question-page');
        const resultPage = document.getElementById('result-page');
        const startTestBtn = document.getElementById('start-test-btn');
        const questionNumberElem = document.getElementById('question-number');
        const questionTextElem = document.getElementById('question-text');
        const optionAButton = document.getElementById('option-a');
        const optionBButton = document.getElementById('option-b');
        const progressBar = document.getElementById('progress-bar');

        const resultCharacterNameElem = document.getElementById('result-character-name');
        const resultMbtiElem = document.getElementById('result-mbti');
        const resultDescriptionElem = document.getElementById('result-description');
        const characterVideoElem = document.getElementById('character-video'); // 비디오 요소를 가져옵니다.
        const characterIconElem = document.getElementById('character-icon'); // 임시 아이콘 요소를 가져옵니다.

        const compatibleFriendNameElem = document.getElementById('compatible-friend-name');
        const compatibleFriendMbtiElem = document.getElementById('compatible-friend-mbti');
        const compatibleFriendDescriptionElem = document.getElementById('compatible-friend-description');
        const oppositeFriendNameElem = document.getElementById('opposite-friend-name');
        const oppositeFriendMbtiElem = document.getElementById('opposite-friend-mbti');
        const oppositeFriendKeywordsElem = document.getElementById('opposite-friend-keywords');

        const shareResultBtn = document.getElementById('share-result-btn');
        const heyDLinkBtn = document.getElementById('hey-d-link-btn');
        const restartTestBtn = document.getElementById('restart-test-btn');

        // 테스트 상태 변수
        let currentQuestionIndex = 0;
        let answers = new Array(32).fill(-1); // 0 또는 1로 채워질 답변 배열

        // MBTI 진단 설문 32 문항 풀 (시나리오 기반으로 재구성)
        // 각 문항은 [질문 텍스트, 선택지 A 텍스트, 선택지 B 텍스트, 해당 축]
        const questions = [
            // Scenario 1: World Tour Finale & Aftermath (Prologue & Huntrix)
            { q: "당신은 K-pop 아이돌 그룹 '헌트릭스'의 멤버. 월드 투어 마지막 공연을 앞두고 있다. 공연팀이 내일 콘서트를 앞두고 파이팅 파티를 하자고 하는데,", a: "함께 참여해 인사를 나누고 힘을 얻고 충전할게요.", b: "내일 공연이 힘들지 않게 오늘은 먼저 들어가서 쉴게요.", axis: "EI" }, // Q1
            { q: "공연을 마치고 내려온 당신. 갑작스럽게 해외의 유명 프로덕션 아티스트가 함께 콜라보를 하자고 제안하는데,", a: "바로 오케이 콜!", b: "조금 생각해볼게요.", axis: "EI" }, // Q10
            { q: "성공적인 월드 투어를 마치고 휴식기가 주어졌다. 멤버들과 함께 휴가를 보낼 계획을 세우는데,", a: "다 같이 모여 북적이는 파티나 활동을 즐길래요.", b: "혼자만의 시간을 가지며 조용히 재충전할래요.", axis: "EI" }, // Q13
            { q: "휴가 중 찍은 사진들을 SNS에 올리려고 한다면,", a: "찍는 즉시 실시간으로 스토리 업로드!", b: "귀국 후에 신중하게 정리해서 올릴래요.", axis: "EI" }, // Q15
            { q: "시상식 같은 대규모 행사에 참석하는 것은 당신에게 어떤 기분인가요?", a: "수많은 팬들과 에너지를 주고받는 즐거운 시간이에요.", b: "많은 사람 속에서 에너지가 소모되어 피곤함을 느껴요.", axis: "EI" }, // Q21
            { q: "새로운 K-pop 트렌드나 소식을 접할 때, 당신의 정보 습득 방식은?", a: "다양한 매체의 헤드라인을 빠르게 훑어봐요.", b: "관심 있는 분야의 심층 기사를 찾아 자세히 읽어요.", axis: "EI" }, // Q23
            { q: "팬들과의 온라인 Q&A 시간에 질문이 들어왔을 때,", a: "즉흥적으로 떠오르는 대로 솔직하게 답변해요.", b: "잠시 생각하거나 메모한 후 정리된 답변을 제공해요.", axis: "EI" }, // Q28
            { q: "신곡 아이디어를 팀원들에게 설명할 때, 당신은 주로 어떻게 표현하나요?", a: "말로 직접 시연하고 즉흥적으로 소통해요.", b: "글이나 다이어그램으로 체계적으로 정리하여 공유해요.", axis: "EI" }, // Q31

            // Scenario 2: The Attack & Golden Debut (Huntrix & Guima's Rage)
            { q: "비행기 하이재킹 상황, 악귀들이 나타났다! 긴급 상황에서 아이디어를 발상한다면?", a: "기존 방식에 얽매이지 않고, 떠오르는 대로 브레인스토밍해요.", b: "과거 사례나 데이터를 먼저 조사하며 현실적인 해결책을 찾아요.", axis: "SN" }, // Q5
            { q: "새로운 악귀 퇴치 기술을 배워야 한다면, 당신의 학습 방식은?", a: "직접 만져보고 경험하며 몸으로 익혀요.", b: "관련 매뉴얼이나 이론부터 꼼꼼히 읽으며 이해해요.", axis: "SN" }, // Q8
            { q: "악귀가 숨어있을 것 같은 낯선 동네의 식당을 선택해야 한다면,", a: "현장 분위기나 직감에 따라 선택해요.", b: "리뷰나 평점을 확인하고 정보를 바탕으로 결정해요.", axis: "SN" }, // Q9
            { q: "신곡 'Golden'의 브레인스토밍 회의에서 당신의 역할은?", a: "자유로운 대화로 생각을 확장하고 아이디어를 낼게요.", b: "논의된 내용을 문서로 정리하고 공유하며 구체화할게요.", axis: "SN" }, // Q16
            { q: "새로운 팬덤 앱의 UX를 평가해야 한다면?", a: "직관적인 인상과 사용감을 중요하게 생각해요.", b: "기존 가이드라인이나 원칙과 비교하며 평가해요.", axis: "SN" }, // Q18
            { q: "새로운 무대 연출 툴이 베타 버전으로 나왔다. 당신의 사용 결정은?", a: "베타 버전이라도 바로 사용해보며 경험할래요.", b: "안정화된 후에 사용하며 위험을 최소화할래요.", axis: "SN" }, // Q24
            { q: "헌트릭스의 세계관처럼 미지나 판타지 요소가 가득한 스토리에 대한 당신의 취향은?", a: "미지의 세계와 상상력을 자극하는 판타지를 선호해요.", b: "현실적이고 논리적인 논픽션 스토리를 더 좋아해요.", axis: "SN" }, // Q27
            { q: "새로운 취미(예: 악기 연주)를 시작한다면, 당신의 접근 방식은?", a: "일단 직접 해보면서 배우는 것을 선호해요.", b: "강의나 교재부터 찾아보며 이론을 먼저 익혀요.", axis: "SN" }, // Q32

            // Scenario 3: Guima's Plot & Saja Boys (Guima's Rage & Saja Boys)
            { q: "악귀 '귀마'와의 회의 중 논쟁이 생겼을 때, 당신의 대응 방식은?", a: "논리적으로 설득하여 상대방을 이해시킬게요.", b: "분위기를 조율하고 관계를 해치지 않도록 노력할게요.", axis: "TF" }, // Q3
            { q: "힘들어하는 멤버에게 조언을 해줘야 한다면?", a: "객관적인 팩트 기반의 해결책을 제시해요.", b: "먼저 공감하고 위로하며 감정적인 지지를 보내요.", axis: "TF" }, // Q6
            { q: "사자 보이즈와의 대결을 앞두고 큰 의사결정을 해야 한다면?", a: "장단점을 꼼꼼히 분석하고 표로 정리하여 결정해요.", b: "직감이나 팀원들의 분위기를 따르며 결정해요.", axis: "TF" }, // Q11
            { q: "신곡 'Golden' 뮤직비디오에 기술적 오류가 발생했다면?", a: "원인을 정확히 로깅하고 체계적으로 수정할게요.", b: "전반적인 느낌을 살피며 직관적으로 수정할게요.", axis: "TF" }, // Q14
            { q: "팬에게 특별한 선물을 준비한다면?", a: "서프라이즈 이벤트를 기획하여 감동을 줄래요.", b: "필요한 것을 직접 물어보고 실용적인 선물을 준비해요.", axis: "TF" }, // Q19
            { q: "악귀의 문제 해결에 접근할 때, 당신의 우선순위는?", a: "이론과 원칙을 우선시하여 해결 방안을 모색해요.", b: "과거 사례나 경험을 바탕으로 해결 방안을 찾아요.", axis: "TF" }, // Q20
            { q: "멤버에게 피드백을 줘야 한다면, 당신의 방식은?", a: "직설적이고 명확하게 코멘트해요.", b: "상대방의 감정을 고려하여 완충 표현을 사용해요.", axis: "TF" }, // Q25
            { q: "팀 내 갈등 상황이 발생했을 때, 당신의 대처는?", a: "규칙과 원칙을 적용하여 공정하게 해결해요.", b: "관계와 감정을 고려하여 조화롭게 해결해요.", axis: "TF" }, // Q29

            // Scenario 4: The Betrayal & New Hope (Revealed Secret & Ending)
            { q: "2주간의 휴식기가 주어졌다. 당신의 주말 계획은?", a: "미리 세세하게 계획을 짜서 효율적으로 보낼래요.", b: "즉흥적으로 그때그때 하고 싶은 것을 즐길래요.", axis: "JP" }, // Q2
            { q: "월드 투어 중 찍은 수많은 사진들을 정리하는 방식은?", a: "폴더별로 체계적으로 분류하고 정리해요.", b: "기분 내킬 때마다 조금씩 정리하거나 쌓아둬요.", axis: "JP" }, // Q4
            { q: "해외 공연 출장 전날 짐 싸기는?", a: "일주일 전부터 미리미리 완료해요.", b: "공연 당일 아침에 급하게 챙겨요.", axis: "JP" }, // Q7
            { q: "작업 중 핸드폰 알림 음이 울리면?", a: "즉시 확인하고 처리해요.", b: "나중에 몰아서 확인하거나 무시해요.", axis: "JP" }, // Q12
            { q: "칼퇴 직전, 매니저 바비가 급하게 추가 요청을 한다면?", a: "즉시 처리하고 마무리해요.", b: "내일 처리할 수 있는지 확인하고 미룰 수 있다면 미뤄요.", axis: "JP" }, // Q17
            { q: "마감 직전, 무대 연출 계획에 갑작스러운 변경이 생겼다면?", a: "유연하게 수용하고 즉흥적으로 대응해요.", b: "원래 계획을 유지하려고 노력하거나 재계획을 세워요.", axis: "JP" }, // Q22
            { q: "예상치 못한 스케줄 변화가 생겼을 때, 당신의 대응은?", a: "즉흥적으로 대응하며 새로운 상황에 맞춰요.", b: "반드시 재계획을 세워야 마음이 편해요.", axis: "JP" }, // Q26
            { q: "새로운 앨범 준비 업무 체크리스트를 만든다면?", a: "세분화하고 시간 박스를 정해 꼼꼼히 기록해요.", b: "큰 틀만 기록하고 유연하게 진행해요.", axis: "JP" }, // Q30
        ];

        // 캐릭터 & MBTI 매핑 및 키워드 및 설명
        const MBTI_DATA = {
            "ENTJ": { name: "루미 (Huntr/x)", keywords: "리더십·전략·결단", icon: "👑", description: "강력한 리더십과 전략적인 판단으로 팀을 이끄는 당신은, 헌트릭스의 리더 루미처럼 어떤 상황에서도 목표를 향해 나아갑니다.", videoUrl: "https://placehold.co/150x150/60A5FA/FFFFFF/mp4?text=Rumi" },
            "ENFP": { name: "미라 (Huntr/x)", keywords: "자유·창의·열정", icon: "🌈", description: "자유로운 영혼과 넘치는 창의력, 그리고 뜨거운 열정으로 주변을 밝히는 당신은, 헌트릭스의 자유분방한 미라와 닮았어요.", videoUrl: "https://placehold.co/150x150/FACC15/FFFFFF/mp4?text=Mira" },
            "ENTP": { name: "조이 (Huntr/x)", keywords: "재치·실험·변화", icon: "💡", description: "번뜩이는 재치와 끊임없는 실험 정신으로 변화를 추구하는 당신은, 헌트릭스의 독특한 매력 조이와 통합니다.", videoUrl: "https://placehold.co/150x150/A78BFA/FFFFFF/mp4?text=Joy" },
            "INFJ": { name: "지누 (Saja Boys)", keywords: "이상·비전·헌신", icon: "✨", description: "높은 이상과 뚜렷한 비전을 가지고 타인을 위해 헌신하는 당신은, 사자 보이즈의 신비로운 지누처럼 깊은 내면을 가졌어요.", videoUrl: "https://placehold.co/150x150/34D399/FFFFFF/mp4?text=Jinu" },
            "ESFP": { name: "로맨스 사자", keywords: "팬서비스·사교·긍정", icon: "💖", description: "넘치는 팬서비스와 타고난 사교성, 그리고 긍정적인 에너지로 모두를 즐겁게 하는 당신은, 로맨스 사자처럼 매력적입니다.", videoUrl: "https://placehold.co/150x150/EC4899/FFFFFF/mp4?text=Romance+Lion" },
            "INTP": { name: "미스터리 사자", keywords: "분석·호기심·독립", icon: "🔍", description: "날카로운 분석력과 끝없는 호기심으로 독립적인 사고를 하는 당신은, 미스터리 사자처럼 자신만의 세계를 탐구합니다.", videoUrl: "https://placehold.co/150x150/6B7280/FFFFFF/mp4?text=Mystery+Lion" },
            "ESTP": { name: "애비 사자", keywords: "액션·에너지·즉흥", icon: "💥", description: "넘치는 에너지와 즉흥적인 액션으로 상황을 주도하는 당신은, 애비 사자처럼 거침없이 돌진하는 매력이 있어요.", videoUrl: "https://placehold.co/150x150/EF4444/FFFFFF/mp4?text=Abbey+Lion" },
            "ISFP": { name: "베이비 사자", keywords: "순수·감성·유연", icon: "🌸", description: "순수한 감성과 유연한 사고로 세상을 바라보는 당신은, 베이비 사자처럼 섬세하고 예술적인 감각을 지녔습니다.", videoUrl: "https://placehold.co/150x150/FDBA74/FFFFFF/mp4?text=Baby+Lion" },
            "ISTP": { name: "까치 ‘써씨’", keywords: "관찰·정찰·실용", icon: "🛠️", description: "예리한 관찰력과 뛰어난 실용성으로 문제를 해결하는 당신은, 까치 '써씨'처럼 조용하지만 강한 존재감을 드러냅니다.", videoUrl: "https://placehold.co/150x150/1F2937/FFFFFF/mp4?text=Kkachi" },
            "ISFJ": { name: "호랑이 ‘더피’", keywords: "보호·헌신·안정", icon: "🐻", description: "주변 사람들을 보호하고 헌신하며 안정감을 주는 당신은, 호랑이 '더피'처럼 든든하고 믿음직한 존재입니다.", videoUrl: "https://placehold.co/150x150/9CA3AF/FFFFFF/mp4?text=Horangi" },
            "INFP": { name: "한약방 아저씨", keywords: "치유·이상주의·교감", icon: "🌿", description: "타인을 치유하고 높은 이상을 추구하며 깊이 교감하는 당신은, 한약방 아저씨처럼 따뜻하고 사려 깊은 마음을 가졌어요.", videoUrl: "https://placehold.co/150x150/10B981/FFFFFF/mp4?text=Herbalist" },
            "INTJ": { name: "귀마 (악마왕)", keywords: "전략·야망·통제", icon: "😈", description: "치밀한 전략과 거대한 야망으로 모든 것을 통제하려는 당신은, 악마왕 귀마처럼 강력한 카리스마를 지녔습니다.", videoUrl: "https://placehold.co/150x150/000000/FFFFFF/mp4?text=Guima" },
            "ESFJ": { name: "매니저 ‘보비’", keywords: "조정·조직·케어", icon: "🤝", description: "뛰어난 조정 능력과 체계적인 조직력으로 모두를 케어하는 당신은, 매니저 '보비'처럼 팀의 든든한 버팀목이 됩니다.", videoUrl: "https://placehold.co/150x150/F97316/FFFFFF/mp4?text=Bobby" },
            "ENFJ": { name: "실린 (전설 헌터)", keywords: "멘토링·영향력·통찰", icon: "🌟", description: "타인을 멘토링하고 긍정적인 영향력을 행사하며 통찰력 있는 당신은, 전설 헌터 실린처럼 주변에 영감을 줍니다.", videoUrl: "https://placehold.co/150x150/8B5CF6/FFFFFF/mp4?text=Celine" },
            "ESTJ": { name: "‘소다팝’ 팬 아줌마", keywords: "열정·리더·규칙", icon: "🎤", description: "넘치는 열정과 타고난 리더십, 그리고 명확한 규칙을 중시하는 당신은, '소다팝' 팬 아줌마처럼 강한 추진력을 가졌어요.", videoUrl: "https://placehold.co/150x150/DC2626/FFFFFF/mp4?text=SodaPop+Fan" },
            "ISTJ": { name: "다크 지누", keywords: "책임·규율·내성", icon: "🔒", description: "강한 책임감과 엄격한 규율을 지키며 내성적인 당신은, 다크 지누처럼 묵묵히 자신의 길을 가는 믿음직한 존재입니다.", videoUrl: "https://placehold.co/150x150/4B5563/FFFFFF/mp4?text=Dark+Jinu" },
        };

        // MBTI 궁합 (잘 맞는 친구 / 앙숙 친구) - 단순화된 매핑
        const COMPATIBILITY_MAP = {
            "ENTJ": { compatible: "INFP", compatible_desc: "따뜻한 마음으로 타인을 치유하고 이상을 추구하는 친구", opposite: "ISFP" },
            "ENFP": { compatible: "INTJ", compatible_desc: "치밀한 전략과 야망을 가진 통찰력 있는 친구", opposite: "ISTJ" },
            "ENTP": { compatible: "INFJ", compatible_desc: "깊은 이상과 비전을 가지고 헌신하는 친구", opposite: "ISFJ" },
            "INFJ": { compatible: "ENTP", compatible_desc: "번뜩이는 재치와 실험 정신으로 변화를 추구하는 친구", opposite: "ESTP" },
            "ESFP": { compatible: "ISTJ", compatible_desc: "강한 책임감과 규율을 지키는 믿음직한 친구", opposite: "INTJ" },
            "INTP": { compatible: "ENFJ", compatible_desc: "타인을 멘토링하고 긍정적인 영향력을 주는 친구", opposite: "ESFJ" },
            "ESTP": { compatible: "INFJ", compatible_desc: "깊은 이상과 비전을 가지고 헌신하는 친구", opposite: "INFP" },
            "ISFP": { compatible: "ENTJ", compatible_desc: "강력한 리더십과 전략적인 판단을 하는 친구", opposite: "ESTJ" },
            "ISTP": { compatible: "ESFJ", compatible_desc: "뛰어난 조정 능력과 조직력으로 모두를 케어하는 친구", opposite: "ENFJ" },
            "ISFJ": { compatible: "ENTP", compatible_desc: "번뜩이는 재치와 실험 정신으로 변화를 추구하는 친구", opposite: "INTP" },
            "INFP": { compatible: "ENTJ", compatible_desc: "강력한 리더십과 전략적인 판단을 하는 친구", opposite: "ESTP" },
            "INTJ": { compatible: "ENFP", compatible_desc: "자유로운 영혼과 넘치는 창의력을 가진 친구", opposite: "ESFP" },
            "ESFJ": { compatible: "ISTP", compatible_desc: "예리한 관찰력과 실용성으로 문제를 해결하는 친구", opposite: "INTP" },
            "ENFJ": { compatible: "INTP", compatible_desc: "날카로운 분석력과 끝없는 호기심을 가진 친구", opposite: "ISTP" },
            "ESTJ": { compatible: "ISFP", compatible_desc: "순수한 감성과 유연한 사고로 세상을 바라보는 친구", opposite: "INFP" },
            "ISTJ": { compatible: "ESFP", compatible_desc: "넘치는 팬서비스와 타고난 사교성을 가진 친구", opposite: "ENFP" },
        };

        // 테스트 시작 함수
        function startTest() {
            landingPage.classList.add('hidden');
            questionPage.classList.remove('hidden');
            currentQuestionIndex = 0;
            answers.fill(-1); // 답변 초기화
            displayQuestion();
        }

        // 질문 표시 함수
        function displayQuestion() {
            if (currentQuestionIndex < questions.length) {
                const q = questions[currentQuestionIndex];
                questionNumberElem.textContent = `${currentQuestionIndex + 1} / ${questions.length}`;
                questionTextElem.textContent = q.q;
                optionAButton.textContent = q.a;
                optionBButton.textContent = q.b;

                // 선택된 옵션 스타일 초기화
                optionAButton.classList.remove('selected');
                optionBButton.classList.remove('selected');

                // 진행률 업데이트
                const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
                progressBar.style.width = `${progress}%`;
            } else {
                calculateResult();
            }
        }

        // 답변 선택 처리 함수
        function handleAnswer(value) {
            answers[currentQuestionIndex] = value;
            currentQuestionIndex++;
            displayQuestion();
        }

        // MBTI 결과 계산 함수
        function calculateResult() {
            const scores = { EI: 0, SN: 0, TF: 0, JP: 0 };

            // 각 축별 점수 계산
            // E-I: Q1, Q10, Q13, Q15, Q21, Q23, Q28, Q31 (index 0-7)
            for (let i = 0; i < 8; i++) {
                scores.EI += answers[i];
            }
            // S-N: Q5, Q8, Q9, Q16, Q18, Q24, Q27, Q32 (index 8-15)
            for (let i = 8; i < 16; i++) {
                scores.SN += answers[i];
            }
            // T-F: Q3, Q6, Q11, Q14, Q19, Q20, Q25, Q29 (index 16-23)
            for (let i = 16; i < 24; i++) {
                scores.TF += answers[i];
            }
            // J-P: Q2, Q4, Q7, Q12, Q17, Q22, Q26, Q30 (index 24-31)
            for (let i = 24; i < 32; i++) {
                scores.JP += answers[i];
            }

            // MBTI 유형 결정
            const ei = scores.EI >= 4 ? "E" : "I";
            const sn = scores.SN >= 4 ? "S" : "N";
            const tf = scores.TF >= 4 ? "T" : "F";
            const jp = scores.JP >= 4 ? "J" : "P";

            const mbtiType = `${ei}${sn}${tf}${jp}`;
            displayResult(mbtiType);
        }

        // 결과 표시 함수
        function displayResult(mbtiType) {
            questionPage.classList.add('hidden');
            resultPage.classList.remove('hidden');

            const characterData = MBTI_DATA[mbtiType];
            const compatibility = COMPATIBILITY_MAP[mbtiType];

            if (characterData) {
                resultCharacterNameElem.textContent = characterData.name;
                resultMbtiElem.textContent = `MBTI: ${mbtiType}`;
                resultDescriptionElem.textContent = characterData.description;
                
                // 비디오 설정
                characterVideoElem.querySelector('source').src = characterData.videoUrl;
                characterVideoElem.load(); // 비디오 소스 변경 후 다시 로드
                characterVideoElem.classList.remove('hidden'); // 비디오 표시
                characterIconElem.classList.add('hidden'); // 임시 아이콘 숨김

                // 비디오 로드 실패 시 대체 아이콘 표시 (onerror는 source 태그에 직접 적용 불가하여 JS로 처리)
                characterVideoElem.onerror = () => {
                    characterVideoElem.classList.add('hidden');
                    characterIconElem.classList.remove('hidden');
                    console.error('Video failed to load for:', characterData.name);
                };


                // 잘 맞는 친구
                const compatibleChar = MBTI_DATA[compatibility.compatible];
                compatibleFriendNameElem.textContent = compatibleChar.name;
                compatibleFriendMbtiElem.textContent = `MBTI: ${compatibility.compatible}`;
                compatibleFriendDescriptionElem.textContent = compatibility.compatible_desc;

                // 앙숙 친구
                const oppositeChar = MBTI_DATA[compatibility.opposite];
                oppositeFriendNameElem.textContent = oppositeChar.name;
                oppositeFriendMbtiElem.textContent = `MBTI: ${compatibility.opposite}`;
                oppositeFriendKeywordsElem.textContent = oppositeChar.keywords;

            } else {
                resultCharacterNameElem.textContent = "결과를 찾을 수 없습니다.";
                resultMbtiElem.textContent = "";
                resultDescriptionElem.textContent = "";
                characterVideoElem.classList.add('hidden'); // 비디오 숨김
                characterIconElem.classList.remove('hidden'); // 임시 아이콘 표시
                compatibleFriendNameElem.textContent = "";
                compatibleFriendMbtiElem.textContent = "";
                compatibleFriendDescriptionElem.textContent = "";
                oppositeFriendNameElem.textContent = "";
                oppositeFriendMbtiElem.textContent = "";
                oppositeFriendKeywordsElem.textContent = "";
            }
        }

        // 테스트 다시 시작 함수
        function restartTest() {
            resultPage.classList.add('hidden');
            landingPage.classList.remove('hidden');
            currentQuestionIndex = 0;
            answers.fill(-1);
            progressBar.style.width = '0%';
            // 테스트 재시작 시 비디오와 아이콘 상태 초기화
            characterVideoElem.classList.add('hidden');
            characterIconElem.classList.remove('hidden');
            characterVideoElem.querySelector('source').src = ""; // 비디오 소스 초기화
            characterVideoElem.load(); // 비디오 로드 상태 초기화
        }

        // 이벤트 리스너
        startTestBtn.addEventListener('click', startTest);

        optionAButton.addEventListener('click', () => {
            optionAButton.classList.add('selected');
            optionBButton.classList.remove('selected');
            setTimeout(() => handleAnswer(parseInt(optionAButton.dataset.value)), 200); // 짧은 딜레이 후 다음 질문
        });

        optionBButton.addEventListener('click', () => {
            optionBButton.classList.add('selected');
            optionAButton.classList.remove('selected');
            setTimeout(() => handleAnswer(parseInt(optionBButton.dataset.value)), 200); // 짧은 딜레이 후 다음 질문
        });

        restartTestBtn.addEventListener('click', restartTest);

        // 공유 버튼 (실제 공유 기능은 플랫폼에 따라 다름)
        shareResultBtn.addEventListener('click', () => {
            const mbti = resultMbtiElem.textContent.replace('MBTI: ', '');
            const character = resultCharacterNameElem.textContent;
            const shareText = `저는 케이팝 데몬 헌터스에서 ${character} (${mbti}) 유형이 나왔어요! 당신의 유형은 무엇인가요? #케이팝데몬헌터스 #MBTI테스트`;

            if (navigator.share) {
                navigator.share({
                    title: '케이팝 데몬 헌터스 캐릭터 유형 테스트',
                    text: shareText,
                    url: window.location.href, // 현재 페이지 URL 공유
                }).then(() => console.log('공유 성공'))
                  .catch((error) => console.error('공유 실패', error));
            } else {
                // 웹 공유 API를 지원하지 않는 경우, 텍스트를 클립보드에 복사
                const tempInput = document.createElement('textarea');
                tempInput.value = shareText + '\n' + window.location.href;
                document.body.appendChild(tempInput);
                tempInput.select();
                document.execCommand('copy');
                document.body.removeChild(tempInput);
                alert('결과가 클립보드에 복사되었습니다! 친구들에게 공유해보세요.'); // 사용자에게 알림
            }
        });

        // Hey.D 링크 버튼 (실제 앱/웹 딥링크는 여기에 추가)
        heyDLinkBtn.addEventListener('click', () => {
            // Hey.D 앱/웹 딥링크 URL을 https://hey-d.ai/로 업데이트
            window.open('https://hey-d.ai/', '_blank'); 
        });

    </script>
</body>
</html>
